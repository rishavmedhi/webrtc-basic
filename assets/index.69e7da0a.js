var e=Object.defineProperty,t=Object.prototype.hasOwnProperty,a=Object.getOwnPropertySymbols,n=Object.prototype.propertyIsEnumerable,o=(t,a,n)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n,l=(e,l)=>{for(var r in l||(l={}))t.call(l,r)&&o(e,r,l[r]);if(a)for(var r of a(l))n.call(l,r)&&o(e,r,l[r]);return e};import{f as r,r as c,a as d}from"./vendor.8b9c01ac.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(a){const n=new URL(e,location),o=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((a,l)=>{const r=new URL(e,n);if(self[t].moduleMap[r])return a(self[t].moduleMap[r]);const c=new Blob([`import * as m from '${r}';`,`${t}.moduleMap['${r}']=m;`],{type:"text/javascript"}),d=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(c),onerror(){l(new Error(`Failed to import: ${e}`)),o(d)},onload(){a(self[t].moduleMap[r]),o(d)}});document.head.appendChild(d)})),self[t].moduleMap={}}}("/webrtc-basic/assets/");const s={apiKey:"AIzaSyDfGgUrj_lx1etUMdJNO3QfXkyTTovUFj0",authDomain:"rm-firebase-af352.firebaseapp.com",projectId:"rm-firebase-af352",storageBucket:"rm-firebase-af352.appspot.com",messagingSenderId:"81757488941",appId:"1:81757488941:web:2b7637d33269987da535a4"};r.apps.length||r.initializeApp(s);const i=r.firestore(),p={iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10};function u(){const e=c.createRef(),t=c.createRef();let a=null,n=null;c.useState(0);const[o,r]=c.useState({webcamButton:{disabled:!1},callButton:{disabled:!0},answerButton:{disabled:!0},hangupButton:{disabled:!0},callInputId:""}),[d,s]=c.useState("");c.useEffect((()=>{s(new RTCPeerConnection(p))}),[]);return c.createElement("div",{className:"main-container absolute p-8 bg-indigo-200 md:h-full sm:h-auto",style:{width:"100%"}},c.createElement("h1",{className:"text-2xl text-center"},"Basic WebRTC Platform"),c.createElement("div",{className:"video-container justify-between mt-4 md:flex"},c.createElement("div",{className:""},c.createElement("h3",{className:"text-center"},"Local Stream"),c.createElement(m,{ref:e})),c.createElement("div",{className:"md:pt-0 sm:pt-4"},c.createElement("h3",{className:"text-center"},"Remote Stream"),c.createElement(b,{ref:t}))),c.createElement("div",{className:"control-container m-4 text-center space-y-6"},c.createElement("button",{className:"bg-purple-600 pt-2 pb-2 pl-4 pr-4 text-white rounded font-bold disabled:opacity-50 disabled:cursor-not-allowed",id:"webcamButton",onClick:async()=>{a=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),n=new MediaStream,a.getTracks().forEach((e=>{d.addTrack(e,a)})),d.ontrack=e=>{e.streams[0].getTracks().forEach((e=>{n.addTrack(e)}))},e.current.srcObject=a,t.current.srcObject=n,r(l(l({},o),{callButton:{disabled:!1},answerButton:{disabled:!1},webcamButton:{disabled:!0},hangupButton:{disabled:!1}}))},disabled:o.webcamButton.disabled},"Start webcam"),c.createElement("div",null,c.createElement("h2",null,"2. Create a new Call"),c.createElement("button",{className:"bg-purple-600 pt-2 pb-2 pl-4 pr-4 text-white rounded font-bold disabled:opacity-50 disabled:cursor-not-allowed",id:"callButton",disabled:o.callButton.disabled,onClick:async()=>{const e=i.collection("calls").doc(),t=e.collection("offerCandidates"),a=e.collection("answerCandidates");r(l(l({},o),{callInputId:e.id})),d.onicecandidate=e=>{e.candidate&&t.add(e.candidate.toJSON())};const n=await d.createOffer();await d.setLocalDescription(n);const c={sdp:n.sdp,type:n.type};await e.set({offer:c}),e.onSnapshot((e=>{const t=e.data();if(!d.currentRemoteDescription&&(null==t?void 0:t.answer)){console.log("before RTCSessionDescription");const e=new RTCSessionDescription(t.answer);d.setRemoteDescription(e)}})),a.onSnapshot((e=>{e.docChanges().forEach((e=>{if("added"===e.type){const t=new RTCIceCandidate(e.doc.data());d.addIceCandidate(t).catch((e=>{console.error(e)}))}}))}))}},"Create Call (offer)"),c.createElement("p",null,"Clicking this will create offer code below")),c.createElement("div",null,c.createElement("h2",null,"3. Join a Call"),c.createElement("p",null,"Answer the call from a different browser window or device"),c.createElement("input",{id:"callInput",value:o.callInputId,onChange:e=>{r(l(l({},o),{callInputId:e.target.value}))},className:"border border-gray-300 pt-2 pb-2 pl-2 pr-2 focus:outline-none focus:ring-2 focus:ring-purple-600 focus:border-transparent disabled:opacity-50 md:mr-4 sm:mr-0 mb-4",style:{width:"300px"},placeholder:"offer code to be pasted here"}),c.createElement("button",{className:"bg-purple-600 pt-2 pb-2 pl-4 pr-4 text-white rounded font-bold mt-0 disabled:opacity-50 disabled:cursor-not-allowed",id:"answerButton",disabled:o.answerButton.disabled,onClick:async()=>{const e=o.callInputId,t=i.collection("calls").doc(e),a=t.collection("answerCandidates"),n=t.collection("offerCandidates");d.onicecandidate=e=>{e.candidate&&a.add(e.candidate.toJSON())};const l=(await t.get()).data().offer;await d.setRemoteDescription(new RTCSessionDescription(l));const r=await d.createAnswer();await d.setLocalDescription(r);const c={type:r.type,sdp:r.sdp};await t.update({answer:c}),n.onSnapshot((e=>{e.docChanges().forEach((e=>{if(console.log(e),"added"===e.type){let t=e.doc.data();d.addIceCandidate(new RTCIceCandidate(t)).catch((e=>{console.error(e.name)}))}}))}))}},"Answer")),c.createElement("div",null,c.createElement("h2",null,"4. Hangup"),c.createElement("button",{id:"hangupButton",className:"bg-purple-600 pt-2 pb-2 pl-4 pr-4 text-white rounded font-bold disabled:opacity-50 disabled:cursor-not-allowed",disabled:o.hangupButton.disabled,onClick:()=>{window.location.reload()}},"Hangup"))))}const m=c.forwardRef(((e,t)=>c.createElement("video",{className:"bg-black w-500 h-auto sm:w-full",ref:t,id:"webcamVideo",autoPlay:!0,playsInline:!0}))),b=c.forwardRef(((e,t)=>c.createElement("video",{className:"bg-black w-500 h-auto sm:w-full",ref:t,id:"remoteVideo",autoPlay:!0,playsInline:!0})));d.render(c.createElement(c.StrictMode,null,c.createElement(u,null)),document.getElementById("root"));
