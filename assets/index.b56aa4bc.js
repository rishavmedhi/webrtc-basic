var e=Object.defineProperty,t=Object.prototype.hasOwnProperty,a=Object.getOwnPropertySymbols,n=Object.prototype.propertyIsEnumerable,o=(t,a,n)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n,c=(e,c)=>{for(var r in c||(c={}))t.call(c,r)&&o(e,r,c[r]);if(a)for(var r of a(c))n.call(c,r)&&o(e,r,c[r]);return e};import{f as r,r as l,a as s}from"./vendor.8b9c01ac.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(a){const n=new URL(e,location),o=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((a,c)=>{const r=new URL(e,n);if(self[t].moduleMap[r])return a(self[t].moduleMap[r]);const l=new Blob([`import * as m from '${r}';`,`${t}.moduleMap['${r}']=m;`],{type:"text/javascript"}),s=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(l),onerror(){c(new Error(`Failed to import: ${e}`)),o(s)},onload(){a(self[t].moduleMap[r]),o(s)}});document.head.appendChild(s)})),self[t].moduleMap={}}}("/assets/");const d={apiKey:"AIzaSyBfTpcBP0Ujc8mNNaxyXEvPIrXyVnN9e8g",authDomain:"rm-firebase-af352.firebaseapp.com",projectId:"rm-firebase-af352",storageBucket:"rm-firebase-af352.appspot.com",messagingSenderId:"81757488941",appId:"1:81757488941:web:2b7637d33269987da535a4"};r.apps.length||r.initializeApp(d);const i=r.firestore(),p={iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10};function m(){const e=l.createRef(),t=l.createRef();let a=null,n=null;l.useState(0);const[o,r]=l.useState({webcamButton:{disabled:!1},callButton:{disabled:!0},answerButton:{disabled:!0},callInputId:""}),[s,d]=l.useState("");l.useEffect((()=>{d(new RTCPeerConnection(p))}),[]);return l.createElement("div",{className:"main-container h-screen p-8 bg-indigo-200"},l.createElement("h1",{className:"text-2xl text-center"},"Basic WebRTC Platform"),l.createElement("div",{className:"video-container justify-between mt-4 md:flex"},l.createElement("div",{className:""},l.createElement("h3",{className:"text-center"},"Local Stream"),l.createElement(u,{ref:e})),l.createElement("div",{className:"md:pt-0 sm:pt-4"},l.createElement("h3",{className:"text-center"},"Remote Stream"),l.createElement(f,{ref:t}))),l.createElement("div",{className:"control-container m-4 text-center space-y-6"},l.createElement("button",{className:"bg-purple-600 pt-2 pb-2 pl-4 pr-4 text-white rounded font-bold",id:"webcamButton",onClick:async()=>{a=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),n=new MediaStream,a.getTracks().forEach((e=>{s.addTrack(e,a)})),s.ontrack=e=>{e.streams[0].getTracks().forEach((e=>{n.addTrack(e)}))},e.current.srcObject=a,t.current.srcObject=n,r(c(c({},o),{callButton:{disabled:!1},answerButton:{disabled:!1},webcamButton:{disabled:!0}}))},disabled:o.webcamButton.disabled},"Start webcam"),l.createElement("div",null,l.createElement("h2",null,"2. Create a new Call"),l.createElement("button",{className:"bg-purple-600 pt-2 pb-2 pl-4 pr-4 text-white rounded font-bold",id:"callButton",disabled:o.callButton.disabled,onClick:async()=>{const e=i.collection("calls").doc(),t=e.collection("offerCandidates"),a=e.collection("answerCandidates");r(c(c({},o),{callInputId:e.id})),s.onicecandidate=e=>{e.candidate&&t.add(e.candidate.toJSON())};const n=await s.createOffer();await s.setLocalDescription(n);const l={sdp:n.sdp,type:n.type};await e.set({offer:l}),e.onSnapshot((e=>{const t=e.data();if(!s.currentRemoteDescription&&(null==t?void 0:t.answer)){console.log("before RTCSessionDescription");const e=new RTCSessionDescription(t.answer);s.setRemoteDescription(e)}})),a.onSnapshot((e=>{e.docChanges().forEach((e=>{if("added"===e.type){const t=new RTCIceCandidate(e.doc.data());s.addIceCandidate(t).catch((e=>{console.error(e)}))}}))}))}},"Create Call (offer)")),l.createElement("div",null,l.createElement("h2",null,"3. Join a Call"),l.createElement("p",null,"Answer the call from a different browser window or device"),l.createElement("input",{id:"callInput",value:o.callInputId,onChange:e=>{r(c(c({},o),{callInputId:e.target.value}))},className:"mr-4 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-purple-600 focus:border-transparent"}),l.createElement("button",{className:"bg-purple-600 pt-2 pb-2 pl-4 pr-4 text-white rounded font-bold",id:"answerButton",disabled:o.answerButton.disabled,onClick:async()=>{const e=o.callInputId,t=i.collection("calls").doc(e),a=t.collection("answerCandidates"),n=t.collection("offerCandidates");s.onicecandidate=e=>{e.candidate&&a.add(e.candidate.toJSON())};const c=(await t.get()).data().offer;await s.setRemoteDescription(new RTCSessionDescription(c));const r=await s.createAnswer();await s.setLocalDescription(r);const l={type:r.type,sdp:r.sdp};await t.update({answer:l}),n.onSnapshot((e=>{e.docChanges().forEach((e=>{if(console.log(e),"added"===e.type){let t=e.doc.data();s.addIceCandidate(new RTCIceCandidate(t)).catch((e=>{console.error(e.name)}))}}))}))}},"Answer")),l.createElement("div",null,l.createElement("h2",null,"4. Hangup"),l.createElement("button",{id:"hangupButton",className:"bg-purple-600 pt-2 pb-2 pl-4 pr-4 text-white rounded font-bold",disabled:!0},"Hangup"))))}const u=l.forwardRef(((e,t)=>l.createElement("video",{className:"bg-black w-600 h-auto sm:w-full",ref:t,id:"webcamVideo",autoPlay:!0,playsInline:!0}))),f=l.forwardRef(((e,t)=>l.createElement("video",{className:"bg-black w-600 h-auto sm:w-full",ref:t,id:"remoteVideo",autoPlay:!0,playsInline:!0})));s.render(l.createElement(l.StrictMode,null,l.createElement(m,null)),document.getElementById("root"));
